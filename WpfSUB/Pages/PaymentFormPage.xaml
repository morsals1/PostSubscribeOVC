<Page x:Class="WpfSUB.Pages.PaymentFormPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      Title="Регистрация платежа">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <TextBlock Grid.Row="0" Text="Регистрация нового платежа" 
                   FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
        <StackPanel Grid.Row="1">
            <Label Content="Подписка:"/>
            <ComboBox x:Name="SubscriptionComboBox"
          SelectionChanged="SubscriptionComboBox_SelectionChanged"
          Margin="0,0,0,10">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel>
                            <TextBlock>
                    <Run Text="ID: "/>
                    <Run Text="{Binding Id}" FontWeight="Bold"/>
                    <Run Text=" - "/>
                    <Run Text="{Binding Client.FullName}"/>
                            </TextBlock>
                            <TextBlock>
                    <Run Text="Издание: "/>
                    <Run Text="{Binding Publication.Title}"/>
                    <Run Text=" (Сумма: "/>
                    <Run Text="{Binding TotalPrice, StringFormat={}{0:C}}"/>
                    <Run Text=")"/>
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBlock x:Name="SubscriptionInfoTextBlock" Margin="0,0,0,10" 
                       TextWrapping="Wrap" Foreground="Gray"/>
            <Label Content="Сумма платежа (руб.):"/>
            <TextBox x:Name="AmountTextBox" Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="0,0,0,10"/>
            <Label Content="Номер квитанции:"/>
            <TextBox x:Name="ReceiptNumberTextBox" Text="{Binding ReceiptNumber, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="0,0,0,10"/>
            <Button Content="Сгенерировать номер" Click="GenerateReceiptNumber_Click" 
                    HorizontalAlignment="Left" Margin="0,0,0,10" Width="150"/>
            <Label Content="Способ оплаты:"/>
            <ComboBox x:Name="PaymentMethodComboBox" 
          SelectedValue="{Binding PaymentMethod, UpdateSourceTrigger=PropertyChanged}"
          Margin="0,0,0,10">
                <sys:String xmlns:sys="clr-namespace:System;assembly=mscorlib">наличные</sys:String>
                <sys:String>карта_отделение</sys:String>
                <sys:String>карта_онлайн</sys:String>
                <sys:String>банковский_перевод</sys:String>
            </ComboBox>
            <Label Content="ID транзакции (для онлайн платежей):"/>
            <TextBox x:Name="TransactionIdTextBox" Text="{Binding BankTransactionId, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="0,0,0,10"/>
            <Button Content="Сгенерировать ID транзакции" 
                    Click="GenerateTransactionId_Click" 
                    HorizontalAlignment="Left" Margin="0,0,0,10" Width="180"/>
            <Label Content="Оператор (опционально):"/>
            <ComboBox x:Name="OperatorComboBox" DisplayMemberPath="FullName" 
                      Margin="0,0,0,10"/>
        </StackPanel>
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button x:Name="SaveButton" Content="Зарегистрировать платеж" 
                    Click="Save_Click" Width="180" Margin="5" FontWeight="Bold" Background="#4CAF50" Foreground="White"/>
            <Button Content="Отмена" Click="Cancel_Click" Width="100" Margin="5"/>
        </StackPanel>
    </Grid>
</Page>